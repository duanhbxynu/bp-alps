<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link href="../css/reset.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<style>
			/*html,
			body {
				background-color: #efeff4;
			}*/
			.mui-tab-item.mui-active{
				color: #0062CC!important;
			}
		</style>
	</head>

	<body>
		<!--<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-icon mui-icon-plusempty mui-pull-left mui-hidden" id="icon-add"></a>
			<a class="mui-icon mui-icon-search mui-pull-right mui-hidden" id="icon-search"></a>
			<h1 id="title" class="mui-title">线索</h1>
		</header>-->
		<nav class="mui-bar mui-bar-tab">
			<a id="leadsTab" class="mui-tab-item mui-active" href="#" data-wid='leads/index-leads-nav.html'>
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">线索</span>
			</a>
			<a id="opporTab" class="mui-tab-item" href="#" data-wid="opportunity/index-opportunity-nav.html">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">意向</span>
			</a>
			<a id="orderTab" class="mui-tab-item" href="#" data-wid="order/index-order-nav.html">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">订单</span>
			</a>
			<a class="mui-tab-item" href="#">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">发现</span>
			</a>
			<a class="mui-tab-item" href="#">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" charset="utf-8">
			 //mui初始化
			 
			 mui.plusReady(function() {
			 	
			 	if(!localStorage.getItem('$state')) {
					plus.nativeUI.toast('哎哟，出错了，请稍后再试！');
					common.baseOption.goToLogin();
					return;
				}
				//设置默认打开首页显示的子页序号
//				var Index = 0;
				//把子页面路径写在数组里面
				var subpages = ['leads/index-leads-nav.html', 'leads/index-opportunity-nav.html', 'opportunity/index-order-nav.html']
				//获取当前页面所属的Webview窗口对象
				var self = plus.webview.currentWebview();
				for(var i = 0; i < 5; i++) {
					//创建webview子页
					var sub = plus.webview.create(
						subpages[i], //子页url
						subpages[i], //子页id
						{
							top: '0px',
							bottom: '44px',
							scrollIndicator: "none" //隐藏滚动条
						}
					);
					//如果不是我们设置的子页就隐藏
					if(i > 0) {
						sub.hide();
					}
					//将webview对象填充到窗口
					self.append(sub);
				}
				
			})
			 
			 //当前激活选项
				var activeTab = subpages[0];
				var targetTab;
				mui('.mui-bar-tab').on('tap', 'a', function(e) {
					
					var wvs=plus.webview.all();
					for(var i=0;i<wvs.length;i++){
						console.log('webview'+i+': '+wvs[i].getURL());
						console.log('webview'+i+': '+wvs[i].id);
					}
					
					console.log("点击clicktest="+this.getAttribute('clicktest'));
					//获取子页面的id
					targetTab = this.getAttribute('data-wid');
//					targetTab = subpages[j]
					if(activeTab == targetTab) {
						return
					}
					//显示目标选项卡
					plus.webview.show(targetTab);
					//隐藏当前选项卡
					plus.webview.hide(activeTab);
					//更改当前活跃选项卡
					activeTab = targetTab;
				})
			 
			 //自定义事件，模拟点击“首页选项卡” 
				//即一加载的时候就显示默认的子页面，不然在点击选项卡之前，除了底部选项卡是一片空白
			document.addEventListener('gohome', function() {
				var defaultTab = document.getElementById("leadsTab");
				defaultTab.setAttribute("clicktest",true);
				//模拟首页点击
				mui.trigger(defaultTab, 'tap');
				//切换选项卡高亮
				var current = document.querySelector(".mui-bar-tab>.mui-tab-item.mui-active");
				if (defaultTab !== current) {
					current.classList.remove('mui-active');
					defaultTab.classList.add('mui-active');
				}
			});
			//初始化html
//			function navInit(){
//				mui.init({
//					gestureConfig: {
//						doubletap: true
//					},
////					subpages:navFirst,
//					preloadPages:navOther
//				});
//			}
//			
//			var navFirst=[{
//				url:'leads/index-leads-nav.html',
//				id:'leads/index-leads-nav.html',
//				styles:{
//				    top:'0px',
//		        	bottom:'51px'
//				}
//			}];
//			var navOther=[{
//				url:'leads/index-leads-nav.html',
//				id:'leads/index-leads-nav.html',
//				styles:{
//				    top:'0px',
//		        	bottom:'51px'
//				}
//			},{//缓存其他页面
//				url:'opportunity/index-opportunity-nav.html',
//				id:'opportunity/index-opportunity-nav.html',
//				styles:{
//				    top:'0px',
//		        	bottom:'51px'
//				}
//			},{
//				url:'order/index-order-nav.html',
//				id:'order/index-order-nav.html',
//				styles:{
//				    top:'0px',
//		        	bottom:'51px'
//				}
//			}];
//			var viewObj=[];//第一个页面数据  其他页面数据 窗体对象
//			 //创建子页面，首个选项卡页面显示，其它均隐藏；
//			mui.plusReady(function() {
//				
//				if(!localStorage.getItem('$state')) {
//					plus.nativeUI.toast('哎哟，出错了，请稍后再试！');
//					common.baseOption.goToLogin();
//					return;
//				}
//				navInit();
//				console.log("创建子页面");
//				console.log("创建子页面navOther[0].id="+navOther[0].id);
//				console.log("创建子页面obj="+plus.webview.getWebviewById(navOther[0].id));
//				clickFun(navOther[0].id,plus.webview.getWebviewById(navOther[0].id))
//				mui("nav").on("tap","a",function(e){
//					var id=this.getAttribute("data-wid");
//					console.log(id);
//					var obj=plus.webview.getWebviewById(id);
//					console.log(id);
//					clickFun(id,obj);
//				})
//			});
//			
//			function clickFun(id,obj){
//				console.log("id="+id);
//				console.log("obj="+obj);
//				if(id!=navOther[0].id){
//					console.log(navOther);
//					mui.each(navOther,function(i,v){
//						console.log("otherObj="+v);
//						console.log("otherObj="+v.id);
//						var otherObj=plus.webview.getWebviewById(v.id);
//						console.log("otherObj="+otherObj);
//						otherObj.hide();
//					})
//				}
//				if(obj == null){
//					plus.webview.create(navOther[0].id,navOther[0].url,navOther[0].style);
//					
//				}
//				obj.show();
//			}
			
			 //当前激活选项
		</script>
	</body>

</html>
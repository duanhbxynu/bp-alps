<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/reset.css">
		<link rel="stylesheet" href="../../css/timeline.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css" />-->
		<style>
		
			
			.mui-demo-container {
				padding: 20px 20px 10px 15px;
			}
			
		
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">跟进记录</h1>
		</header>
		<div class="mui-content">
			<div class="mui-demo-container">
				<div id="demo1" class="mui-text-left">
					<div class="timeline">
						<!-- TIMELINE ITEM -->
						<div class="timeline-item">
							<div class="timeline-badge">
							</div>
							<div class="timeline-body">
								<div class="timeline-body-head">
									<p class="timeline-body-head-caption">
										【商谈报价】
										<span class="timeline-body-desc">客户再次报价</span>
									</p>
									
								</div>
								<div class="timeline-body-content">
									<p class="timeline-body-time font-12-666">2018-09-05</span>
									<p class="timeline-body-time font-13-333">浦东店 王丽</span>
								</div>
							</div>
						</div>
						<!-- END TIMELINE ITEM -->
						<!-- TIMELINE ITEM -->
						<div class="timeline-item">
							<div class="timeline-badge">
							</div>
							<div class="timeline-body">
								<div class="timeline-body-head">
									<p class="timeline-body-head-caption">
										【商谈报价】
										<span class="timeline-body-desc">电话沟通报价</span>
									</p>
									
								</div>
								<div class="timeline-body-content">
									<p class="timeline-body-time font-12-666">2018-09-03</span>
									<p class="timeline-body-time font-13-333">浦东店 王丽</span>
								</div>
							</div>
						</div>
						<!-- END TIMELINE ITEM -->
					<!-- TIMELINE ITEM -->
						<div class="timeline-item">
							<div class="timeline-badge">
							</div>
							<div class="timeline-body">
								<div class="timeline-body-head">
									<p class="timeline-body-head-caption">
										【商谈报价】
										<span class="timeline-body-desc">客户答应商谈报价，到店面谈</span>
									</p>
									<p class="timeline-body-time font-12-666">2018-09-03</span>
								</div>
								<div class="timeline-body-head">
									<p class="timeline-body-head-caption">
										【邀约到店】
										<span class="timeline-body-desc">客户上午到店</span>
									</p>
									<p class="timeline-body-time font-12-666">2018-09-02</span>
								</div>
								<div class="timeline-body-content">
									<p class="font-13-333">浦东店 王丽</span>
								</div>
							</div>
						</div>
						<!-- END TIMELINE ITEM -->
					</div>
				</div>

			</div>

		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/common.js"></script>
		<script src="../../js/follow/follow.js"></script>
		<script>
		(function($, doc) {
			
			$.init();
			$.plusReady(function() {

				/*---------关闭滚动条------*/
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				//获取父级页面查询过来的参数
				var self = plus.webview.currentWebview();
				var opporCode = self.opporCode;
//				showFollowRecord(opporCode);
			});
			function showFollowRecord(opporCode){
				
				var params = {
					opportunityCode :opporCode
				}
				follow.getOpporFollow(params,function(data){
					console.log(data);
					console.log(JSON.parse(data));
					var data = JSON.parse(data);
					if(data.success==true) {
						var followOpportunityList = data.followOpportunityList;
						console.log(followOpportunityList.length);
						var timeline = document.body.querySelector('.timeline');
						if(followOpportunityList.length>0){
							$.each(followOpportunityList,function(index,followOpportunity){
								
								var contentHtml = '';
								$.each(followOpportunity.contentList,function(i,content){
						        	contentHtml += '<p class="timeline-body-head-caption">【'+followOpportunity.type+'】'+
														'<span class="timeline-body-desc">'+content.content+'</span>'+
													'</p>'+
													'<p class="timeline-body-time font-12-666">'+content.creationtime+'<p>';
						        })
						
								var timelineItem = document.createElement('div');
								timelineItem.className = 'timeline-item';
								timelineItem.setAttribute("data-code",followOpportunity.code );
								timelineItem.innerHTML ='<div class="timeline-badge"></div>'+
												'<div class="timeline-body">'+
													'<div class="timeline-body-head">'+contentHtml+'</div>'+
													'<div class="timeline-body-content">'+
														'<p class="font-12-333">'+followOpportunity.storeName+'&#12288&#12288'+followOpportunity.salesConsultantName+'</p>'+
													'</div>'+
												'</div>';
								console.log("=============line 123================");
								console.log(timelineItem);
								timeline.appendChild(timelineItem);
							})
						}else{
							doc.getElementById('demo1').innerHTML="<p>没有跟进记录</p>"
						}
					} else if(data.messageCode == '403'){//token过期，重新登录
						plus.nativeUI.toast(data.message);
						common.baseOption.goToLogin();
					}else{
						plus.nativeUI.toast(data.message);
					}
				})
			}
			$('.timeline').on('tap','.timeline-item',function(){
				var recordCode = this.getAttribute('data-code');
				mui.openWindow({
					url: 'follow-record-detail.html',
					id: "followRecordDetail",//默认使用当前页面的url作为id
					extras: {
						recordCode: recordCode
					}, //自定义扩展参数
					createNew: false //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
				})
			})
			
		}(mui, document));
		</script>
	</body>

</html>
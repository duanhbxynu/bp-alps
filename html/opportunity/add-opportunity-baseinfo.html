<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/reset.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<link href="../../css/timeline.css" rel="stylesheet" />
		<!--<link href="../../css/form.css" rel="stylesheet" />-->
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.css" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
		<link rel="stylesheet" type="text/css" href="../../css/icons-extra.css" />
		<style>
			
			
		
			/*.mui-icon-arrowdown {
			   font-size: 14px;
			}
			.mui-icon-arrowdown:after {
			    content: '\e581';
			    font-size: 18px;
			}
			.mui-icon-arrowdown:before {
			    content: '';
			}*/
			
			
		</style>

	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" id="mui-title">创建意向</h1>
		</header>

		<div class="mui-content detail-scroll" id="mui-content">
			<!--<div class="mui-content-padded">
				<div class="mui-padded-item mui-active">
					<span class="mui-badge">1</span>
					<span class="mui-badge-label">基本信息</span>
				</div>
				<div class="mui-padded-item">
					<span class="progress-bar"></span>
				</div>
				<div class="mui-padded-item">
					<span class="mui-badge">2</span>
					<span class="mui-badge-label">业务信息</span>
				</div>
				<div class="mui-padded-item ">
					<span class="progress-bar"></span>
				</div>
				<div class="mui-padded-item">
					<span class="mui-badge">3</span>
					<span class="mui-badge-label">工作家庭信息</span>
				</div>
			</div>-->

			<div class="mui-content-padded" id="progressBar">
				<div class="progressBar"></div>
				<div class="progressBar"></div>
				<div class="course_nr course_nr_1 ">
					<span class="mui-badge badge-active">1</span>
					<span class="mui-badge-label badge-label-active">基本信息</span>
				</div>
				<div class="course_nr course_nr_2">
					<span class="mui-badge">2</span>
					<span class="mui-badge-label">业务信息</span></div>
				<div class="course_nr course_nr_3">
					<span class="mui-badge">3</span>
					<span class="mui-badge-label">工作家庭信息</span></div>
			</div>
			<form class="mui-card">
				<div class="mui-input-group">
					<div class="mui-input-row radio-multiple-row">
						<label class="radio-multiple-label require">客户类型</label>
						<div class="radio-list radio-multiple-list radio-type-list">	
							<div class="mui-radio mui-left customer-type customer-type-personal active">
								<label class="">个人</label>
								<input id="type_personal" name="type" class="type" type="radio" checked="true" />
						    </div>
							<!--<span class="spliter">|</span>--> 
							<div class="mui-radio mui-left customer-type customer-type-company">
								<label class="company">公司</label>
								<input id="type_company" name="type" class="type"  type="radio">
							</div>
						</div>
					</div>
					<div class="mui-input-row">
						<label class="require">姓名</label>
						<input id="input_name" type="text" class="mui-input-clear" placeholder="请输入姓名" value="">
					</div>
					<div class="mui-input-row">
						<label class="require">性别</label>
						<div class="radio-list radio-single-list radio-gender-list">
						    <div class="mui-radio mui-left mui-radio-male active">
								<label class="male">男</label>
								<input id="male" name="gender" class="gender" value="MALE" type="radio" checked="true" />
							</div>
							<div class="mui-radio mui-left mui-radio-female">
								<label class="female">女</label>
								<input id="female" name="gender" class="gender" value="FEMALE"  type="radio">
							</div>
					    </div>
					</div>
					<div class="mui-input-row">
						<label class="require">电话</label>
						<input id="input_mobile" type="text" class="mui-input-clear" placeholder="请输入电话" value="">
					</div>
					<div class="mui-input-row">
						<label>其他联系方式</label>
						<input id="input_other_mobile" type="text" class="mui-input-clear" placeholder="请输入其他联系方式" value="">
					</div>
					<div class="mui-input-row mui-select-row">
						<label>联系地址 </label>
						<span class="mui-select" id="showAddressPicker">
							请选择
						</span>
					</div>
					<div class="mui-input-row">
						<label>详细地址</label>
						<input id="input_address" type="text" class="mui-input-clear" placeholder="请输入详细地址" value="">
					</div>		
				</div>	
						
				<div class="mui-input-group">	
					<div class="mui-button-row">
						<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined btn-cancel" id="btn_cancel">取消</button>
						<button type="button" class="mui-btn mui-btn-danger btn-save" id="next_step">下一步</button>
					</div>
				</div>	
			</form>
		</div>
		<script src="../../js/mui.js"></script>
		<script src="../../js/common.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/mui.picker.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.poppicker.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common/city.data-3.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common/regex.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			(function($, doc) {
				$.init();

				var aniShow = "pop-in";
				//只有ios支持的功能需要在Android平台隐藏；
				if(mui.os.android) {
					var list = document.querySelectorAll('.ios-only');
					if(list) {
						for(var i = 0; i < list.length; i++) {
							list[i].style.display = 'none';
						}
					}
					//Android平台暂时使用slide-in-right动画
					if(parseFloat(mui.os.version) < 4.4) {
						aniShow = "slide-in-right";
					}
				}
			//B页面onload从服务器获取列表数据；
			//联系地址三级联动 动态获取联系地址的联动
		
			
//			window.onload = function() {
//				//联系地址三级联动
//				var addressData = "";
//	//			var addressData = localStorage.getItem("provinceDataList");
//	//			console.log(addressData);
//				addressPicker = new $.PopPicker({
//					layer: 3
//				});
//				addressPicker.setData(address);
//				//从服务器获取数据
//				app.getRegion(function(data){
//					var objectData = JSON.stringify(data);
//					var evalData = eval('('+ data +')');
//					document.getElementById("resultobjectData").innerHTML = evalData.success;
//					
//					if(evalData.success==true){
//						
//						var provinceDataList = evalData.provinceDataList;
//						
//						document.getElementById("result").innerHTML = evalData.provinceDataList;
//						console.log(provinceDataList.length);
//						var evalProvince = "[";
//						for (var i in provinceDataList){
//							var objectToJsonProvince = JSON.stringify(provinceDataList[i]);
//							var province = eval('('+ objectToJsonProvince +')');
////							console.log("=======line212=========");
//							//{id:shanghai label:上海市 citys:[object Object]}
//							var provincetemp = "{";
//							for (var ip in province) { //用javascript的for/in循环遍历对象的属性  
//						        provincetemp += ip + ":" + province[ip] + ","+ "\n";  
////						        console.log("=======line217=========");
////						        console.log(provincetemp);
////						        var citytemp = '['
////						        for(var ipc in provincetemp){
////						        	citytemp += ipc + ":" + provincetemp[ipc] + "\n";  
////						        	
////						        }
//						        
//						    } 
//						    provincetemp = (provincetemp.substring(provincetemp.length - 1) == ',') ? provincetemp.substring(0, provincetemp.length - 1) : provincetemp;
//							provincetemp +="},"+ "\n";
//							
//							console.log(provincetemp);
//							console.log("provincetemp");
//							console.log(JSON.stringify(provincetemp).citys);
//							
//							evalProvince += provincetemp;
//							console.log(provincetemp);
//							
//							
////							console.log(eval('('+ provinceDataList[i] +')'));
//						}
//						evalProvince = (evalProvince.substring(evalProvince.length - 1) == ',') ? evalProvince.substring(0, evalProvince.length - 1) : evalProvince;
//						evalProvince += ']';
//						console.log(evalProvince);
//							
////						var provinceDataList = eval('('+ evalData.provinceDataList +')');
//						
////						document.getElementById("result").innerHTML = provinceDataList;
////						var addressData = common.baseOption.jsonify(provinceDataList);
////						console.log(provinceDataList);
////						console.log("转换");
////						console.log(addressData);
////						
////						console.log(provinceDataList.length);
////						for(var i = 0;i<provinceDataList.length;i++){
////							console.log(common.baseOption.jsonify(provinceDataList[i]));
////						}
//						
////						var addressData = common.baseOption.jsonify(provinceDataList);
//////						addressData = provinceDataList;
////						console.log(addressData);
////						addressPicker.setData(addressData);
////						localStorage.setItem("provinceDataList",provinceDataList);
//	//					return JSON.stringify(provinceDataList);
//					}else{
//						plus.nativeUI.toast('地址查询出错！');
//						common.baseOption.goToLogin();
//					}
//				});
//				

			window.onload = function() {
			
				
//				//业务数据获取完毕，并已插入当前页面DOM；
				//注意：若为ajax请求，则需将如下代码放在处理完ajax响应数据之后；
				mui.plusReady(function() {
					//关闭等待框
					plus.nativeUI.closeWaiting();
					//显示当前页面
//					plus.webview.currentWebview().show();
					//获取父级页面查询过来的参数
					var self = plus.webview.currentWebview();
					var code = self.code;
					var flowToOppor = self.flowToOppor;
					
					console.log(code);
					doc.getElementById("mui-content").setAttribute("data-code",code||'');
					//姓名，性别，联系方式，客流或意向，创建意向的时候都有值
					doc.getElementById("input_name").setAttribute("value",flowToOppor.name);
					doc.getElementById("input_mobile").setAttribute("value",flowToOppor.mobile);
					
					if(flowToOppor.gender == 'MALE'){
						doc.getElementsByClassName("mui-radio-male")[0].classList.add('active');
						doc.getElementById('male').setAttribute("checked",true); 
						doc.getElementsByClassName("mui-radio-female")[0].classList.remove('active');
						doc.getElementById('female').removeAttribute("checked")
					}else if(flowToOppor.gender == 'FEMALE'){
						doc.getElementsByClassName("mui-radio-female")[0].classList.add('active');
						doc.getElementById('female').setAttribute("checked",true); 
						doc.getElementsByClassName("mui-radio-male")[0].classList.remove('active');
						doc.getElementById('male').removeAttribute("checked")
					}
					if(code){
						console.log("不为空，继续跟进");
						console.log(flowToOppor);
						
						
						//客户性质
						if(flowToOppor.buyerTypeCode == 'personal'){
							doc.getElementsByClassName("customer-type-personal")[0].classList.add('active');
							doc.getElementById('type_personal').setAttribute("checked",true); 
							doc.getElementsByClassName("customer-type-company")[0].classList.remove('active');
							doc.getElementById('type_company').removeAttribute("checked");
						}else if(flowToOppor.gender == 'company'){
							doc.getElementsByClassName("mui-radio-company")[0].classList.add('active');
							doc.getElementById('type_company').setAttribute("checked",true); 
							doc.getElementsByClassName("mui-radio-personal")[0].classList.remove('active');
							doc.getElementById('type_personal').removeAttribute("checked");
						}
						if(flowToOppor.otherContact){
							doc.getElementById('input_other_mobile').setAttribute("value",flowToOppor.otherContact);
						}
						if(flowToOppor.otherContact){
							doc.getElementById('input_address').setAttribute("value",flowToOppor.address);
						}
						
						if(flowToOppor.provinceCode||flowToOppor.cityCode||flowToOppor.districtCode){
							
							
//							doc.getElementById('showAddressPicker').innerHTML =(items[0] || {}).text + " "+(items[1] || {}).text + " "+(items[2] || {}).text;
							doc.getElementById('showAddressPicker').setAttribute("data-value",flowToOppor.provinceCode+flowToOppor.cityCode+flowToOppor.districtCode);
							var provinceText = '';
//							mui.each(addressData3,function(i,provinceData){
//								console.log(provinceData);
//								if(provinceData.value == flowToOppor.provinceCode){
//									provinceText = provinceData.text;
//								}
//							})
						}
						
						//遍历省市区
//						mui.each(provinceDataList3,function(i,provinceData){
//							console.log(provinceData);
//								
//						})
						
						
						
					}
					
				});
		
			}
			
			
			
//			$.each(provinceDataList3,function(i,provinceData){
//				console.log("========line327==========");
//				console.log(provinceData.value);
//				console.log(provinceData.text);
//				console.log(provinceData.children);
////				if($("#"+province).val() == provinceData.id){
//				$.each(provinceData.children,function(i,citydata){
//					console.log("========line333==========");
//					console.log(citydata.value);
//					console.log(citydata.text);
//					console.log(citydata.children);
////					if($("#"+cityCode).val() == citydata.id){
//					$.each(citydata.children,function(i,districtsdata){
//						console.log("========line338==========");
//						console.log(districtsdata.value);
//						console.log(districtsdata.text);
//						console.log(districtsdata);
//					});
//				})
//			});
			
			var addressPicker = new $.PopPicker({
					layer: 3
				});
			addressPicker.setData(provinceDataList3);
			
			var showAddressPicker = doc.getElementById('showAddressPicker');
				
			showAddressPicker.addEventListener('tap', function(event) {
				
				addressPicker.show(function(items) {
//					showAddressPicker.innerHTML =addressPicker.getParam(items[0], 'text') + " " + addressPicker.getParam(items[1], 'text') + " " + addressPicker.getParam(items[2], 'text');
					showAddressPicker.innerHTML =(items[0] || {}).text + " "+(items[1] || {}).text + " "+(items[2] || {}).text;
					showAddressPicker.setAttribute("data-value",(items[0] || {}).value+(items[1] || {}).id+(items[2] || {}).id);
						//返回 false 可以阻止选择框的关闭
						//return false;
						
//						document.getElementById("result").innerHTML = address;
				});
			}, false);
			
			
			doc.getElementById("next_step").addEventListener('tap',function(){
				
				var type = doc.querySelector('[name="type"]:checked').value;//客户性质
				var name = doc.getElementById('input_name').value;//姓名
				var gender = doc.querySelector('[name="gender"]:checked').value;//性别
				var mobilestr = doc.getElementById('input_mobile').value;//电话
				
				if(!name){
					return plus.nativeUI.toast("请输入姓名");
				}
				if(!RegCheck.mobile(mobilestr)){
					return plus.nativeUI.toast("请输入正确的电话");
				}
				var otherContact = doc.getElementById('input_other_mobile').value;//其他联系方式
				var addressCode = doc.getElementById('showAddressPicker').getAttribute("data-value");//电话
				var address = doc.getElementById('input_address').value;//其他联系方式
				var code = doc.getElementById("mui-content").getAttribute("data-code");
				var baseOpportunity = {
					code:code,
					type:type,
					name:name,
					gender:gender,
					mobile:mobilestr,
					otherContact:otherContact,
					addressCode:addressCode,
					address:address
				}
//				var baseOppor = JSON.stringify(baseOpportunity);
//				console.log(baseOppor);
				
				mui.openWindow({
					url: '../opportunity/add-opportunity-bussinessinfo.html',
					id: "oppor-bussinessinfo", //默认使用当前页面的url作为id
					styles: { //窗口参数
						popGesture: 'hide'
					},
					extras: {
						baseOpportunity:baseOpportunity
					}, //自定义扩展参数
					show: {
						autoShow: true, //页面loaded事件发生后自动显示，默认为true
						//	aniShow:'pop-in',//页面显示动画，默认为”slide-in-right“；
						//	duration:'300'//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
					},
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...' //等待对话框上显示的提示内容
					},
					createNew: false //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
				})
				
			})
			
			
			
			
			
			
				
				//注意：若为ajax请求，则需将如下代码放在处理完ajax响应数据之后；
//				$.plusReady(function() {
//							//关闭等待框
//					plus.nativeUI.closeWaiting();
//						//显示当前页面
////					plus.webview.currentWebview().show();
//					
//					//从服务器获取数据
////					app.getRegion(function(data){
////						console.log("data");
////						console.log(data);
////						console.log("region result:"+JSON.stringify(data));
////						var data = JSON.stringify(data);
////						console.log("--------------------------------------------------------------");
////						if(data.success==true){
////							var provinceDataList = data.provinceDataList;
////							console.log(provinceDataList);
////						}else{
////							plus.nativeUI.toast('地址查询出错！');
////						   	common.baseOption.goToLogin();
////						}
////					});	
//						
//				})
					
				//性别切换
				$('.radio-gender-list').on('tap','.gender',function(){
					var gender = this;
					
					if (this) {
							
						this.checked = !this.checked;
						$.trigger(this, 'change');
							
						$(".radio-gender-list .mui-radio").each(function () {
							this.classList.remove('active');
						}) 
						gender.parentNode.classList.add('active');
							
					}
				})	
				
				//类型切换
				$('.radio-type-list').on('tap','.type',function(){
					var type = this;
					
					if (this) {
							
						this.checked = !this.checked;
						$.trigger(this, 'change');
							
						$(".radio-type-list .mui-radio").each(function () {
							this.classList.remove('active');
						}) 
						type.parentNode.classList.add('active');
							
					}
				})	
			
				

			}(mui, document));
		</script>
	</body>

</html>